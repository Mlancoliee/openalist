System.register(["./index-legacy-b31e0035.js","./useTitle-legacy-e15089d7.js","./webauthn-json.browser-ponyfill-legacy-2d91bd49.js"],function(e,t){"use strict";var r,n,o,i,a,l,s,c,d,u,g,p,h,f,w,b,m,y,v,x,C,k,_,$,S,I,G,E,j,z,K,P,R,T,U,A,D,M,L,Z,F,J,W,q,B,N,O,H,Q;return{setters:[e=>{r=e.cc,n=e.J,o=e.cd,i=e.ce,a=e.aT,l=e.Z,s=e.y,c=e.ae,d=e.ag,u=e.af,g=e.W,p=e.d,h=e.c8,f=e.cf,w=e.x,b=e.aG,m=e.bk,y=e.bZ,v=e.cg,x=e.ch,C=e.ci,k=e.cj,_=e.b,$=e.G,S=e.q,I=e.ck,G=e.b3,E=e.am,j=e.aa,z=e.bS,K=e.aD,P=e.bR,R=e.S,T=e.I,U=e.b5,A=e.a9,D=e.ao,M=e.D,L=e.bv,Z=e.bw,F=e.cl,J=e.aK,W=e.n,q=e.bl,B=e.cm},e=>{N=e.a},e=>{O=e.s,H=e.g,Q=e.a}],execute:function(){var t=a('<svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink height=896 width=967.8852157128662><defs><path id=path-2 opacity=1 fill-rule=evenodd d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id=linearGradient-3 x1=0.5 y1=0 x2=0.5 y2=1><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-2 fill=url(#linearGradient-3) fill-opacity=1>');const V=e=>{const r=n({startColor:"#28aff0",endColor:"#120fc4"},e);return a=t(),l=a.firstChild.firstChild.nextSibling.firstChild,s=l.nextSibling,o(e=>{var t=r.startColor,n=r.endColor;return t!==e.e&&i(l,"stop-color",e.e=t),n!==e.t&&i(s,"stop-color",e.t=n),e},{e:void 0,t:void 0}),a;var a,l,s};var X=a('<svg height=1337 width=1337><defs><path id=path-1 opacity=1 fill-rule=evenodd d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id=linearGradient-2 x1=0.79 y1=0.62 x2=0.21 y2=0.86><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-1 fill=url(#linearGradient-2) fill-opacity=1>');const Y=e=>{const t=n({startColor:"#28aff0",endColor:"#120fc4"},e);return r=X(),a=r.firstChild.firstChild.nextSibling.firstChild,l=a.nextSibling,o(e=>{var r=t.startColor,n=t.endColor;return r!==e.e&&i(a,"stop-color",e.e=r),n!==e.t&&i(l,"stop-color",e.t=n),e},{e:void 0,t:void 0}),r;var r,a,l},ee=()=>{const e=l("linear-gradient(135deg, #a9c6ff 0%,rgb(233, 154, 211) 100%)","linear-gradient(135deg, #062b74 0%, #1a2980 100%)"),t=[{style:{position:"absolute",top:"10%",left:"15%",width:"300px",height:"300px",background:"radial-gradient(circle, #fff6 0%, #fff0 70%)",filter:"blur(40px)",opacity:.7,pointerEvents:"none"}},{style:{position:"absolute",bottom:"15%",right:"10%",width:"250px",height:"250px",background:"radial-gradient(circle, #a9c6ff88 0%, #fff0 80%)",filter:"blur(30px)",opacity:.5,pointerEvents:"none"}}];return s(d,{get bg(){return e()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[c(()=>t.map(e=>s(d,{get style(){return e.style}}))),s(d,{pos:"absolute",top:"0",left:"0",w:"100vw",h:"100vh",style:{background:"rgba(255,255,255,0.15)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",pointerEvents:"none"}}),s(d,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return s(Y,{})}}),s(d,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return s(V,{})}})]}})},te=()=>{const e=u("sso_login_enabled"),t=g("sso_login_platform"),r=u("sso_compatibility_mode"),{searchParams:n,to:o}=p(),i=n.token;function a(e){const t=e.data;t.token&&(h(t.token),o(decodeURIComponent(n.redirect||f||"/"),!0))}if(null!=i&&""!=i&&(h(i),o(decodeURIComponent(n.redirect||f||"/"),!0)),window.addEventListener("message",a),w(()=>{window.removeEventListener("message",a)}),e){const e=()=>{const e=m.getUri()+"/auth/sso?method=sso_get_token";r?window.location.href=e:window.open(e,"authPopup","width=500,height=600")};let n;switch(t){case"Github":n=k;break;case"Microsoft":n=C;break;case"Google":n=x;break;case"Dingtalk":n=v;break;default:n=y}return s(b,{cursor:"pointer",boxSize:"$8",as:n,p:"$0_5",onclick:e})}};e("default",()=>{const e=g("logo").split("\n"),t=l(e[0],e.pop()),n=_(),o=$(()=>`${n("login.login_to")} ${g("site_title")}`);N(o);const i=l("white","$neutral1"),[a,c]=S(localStorage.getItem("username")||""),[d,y]=S(localStorage.getItem("password")||""),[v,x]=S(""),[C,k]=S(!1),[V,X]=I("remember-pwd","false"),[Y,re]=S(!1),[ne,oe]=G(async()=>{return Y()?m.post("/auth/login/ldap",{username:a(),password:d(),otp_code:v()}):m.post("/auth/login/hash",{username:a(),password:(e=d(),r(`${e}-https://github.com/AlliotTech/openalist`)),otp_code:v()});var e}),[,ie]=G((e,t,r,n)=>m.post("/authn/webauthn_finish_login?username="+r,JSON.stringify(t),{headers:{session:e},signal:n})),[,ae]=G((e,t)=>m.get("/authn/webauthn_begin_login?username="+e,{signal:t})),{searchParams:le,to:se}=p(),ce=u("webauthn_login_enabled"),de=async()=>{k(!C())};let ue=null;const ge=async e=>{if(!O())return void(e||W.error(n("users.webauthn_not_supported")));if(e&&!(await(async()=>!(!PublicKeyCredential||!("isConditionalMediationAvailable"in PublicKeyCredential))&&await PublicKeyCredential.isConditionalMediationAvailable())()))return;ue?.abort();const t=new AbortController;ue=t;const r=e?"":a();e||"true"!==V()?localStorage.removeItem("username"):localStorage.setItem("username",a());const o=await ae(r,t.signal);q(o,async o=>{try{const i=H(o.options);i.signal=t.signal,e&&(i.mediation="conditional");const a=await Q(i),l=await ie(o.session,a,r,t.signal);B(l,e=>{W.success(n("login.success")),h(e.token),se(decodeURIComponent(le.redirect||f||"/"),!0)})}catch(i){i instanceof Error&&"AbortError"!=i.name&&W.error(i.message)}})},pe=()=>ue?.abort();E(()=>{ce&&(window.addEventListener("beforeunload",pe),ge(!0))}),w(()=>{ue?.abort(),window.removeEventListener("beforeunload",pe)});const he=async()=>{if(C())await ge();else{"true"===V()?(localStorage.setItem("username",a()),localStorage.setItem("password",d())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const e=await oe();B(e,e=>{W.success(n("login.success")),h(e.token),se(decodeURIComponent(le.redirect||f||"/"),!0)},(e,t)=>{fe()||402!==t?W.error(e):we(!0)})}},[fe,we]=S(!1),be=u("ldap_login_enabled"),me=g("ldap_login_tips");return be&&re(!0),s(J,{zIndex:"1",w:"$full",h:"100vh",get children(){return[s(j,{get bgColor(){return i()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[s(z,{alignItems:"center",justifyContent:"space-around",get children(){return[s(K,{mr:"$2",boxSize:"$12",get src(){return t()}}),s(P,{color:"$info9",fontSize:"$2xl",get children(){return o()}})]}}),s(R,{get when(){return!fe()},get fallback(){return s(T,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return v()},onInput:e=>x(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&he()}})},get children(){return[s(T,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return a()},onInput:e=>c(e.currentTarget.value)}),s(R,{get when(){return!C()},get children(){return s(T,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return d()},onInput:e=>y(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&he()}})}}),s(z,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[s(U,{get checked(){return"true"===V()},onChange:()=>X("true"===V()?"false":"true"),get children(){return n("login.remember")}}),s(A,{as:"a",target:"_blank",get href(){return n("login.forget_url")},get children(){return n("login.forget")}})]}})]}}),s(D,{w:"$full",spacing:"$2",get children(){return[s(R,{get when(){return!C()},get children(){return s(M,{colorScheme:"primary",w:"$full",onClick:()=>{fe()?x(""):(c(""),y(""))},get children(){return n("login.clear")}})}}),s(M,{w:"$full",get loading(){return ne()},onClick:he,get children(){return n("login.login")}})]}}),s(R,{when:be,get children(){return s(U,{w:"$full",get checked(){return!0===Y()},onChange:()=>re(!Y()),children:me})}}),s(M,{w:"$full",colorScheme:"accent",onClick:()=>{h(),se(decodeURIComponent(le.redirect||f||"/"),!0)},get children(){return n("login.use_guest")}}),s(z,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[s(L,{}),s(Z,{}),s(te,{}),s(R,{when:ce,get children(){return s(b,{cursor:"pointer",boxSize:"$8",as:F,p:"$0_5",onclick:de})}})]}})]}}),s(ee,{})]}})})}}});
