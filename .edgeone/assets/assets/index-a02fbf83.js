import{cc as pe,J,cd as q,ce as I,aT as V,Z as z,y as e,ae as he,ag as w,af as E,W as S,d as Q,c8 as y,cf as _,x as X,aG as Y,bk as x,bZ as fe,cg as me,ch as be,ci as we,cj as Ce,b as ve,G as xe,q as b,ck as ye,b3 as A,am as _e,aa as $e,bS as U,aD as ke,bR as Se,S as C,I as F,b5 as Z,a9 as Ie,ao as Ee,D as O,bv as Le,bw as Ge,cl as Re,aK as Pe,n as v,bl as Te,cm as H}from"./index-505ecd4e.js";import{a as Me}from"./useTitle-97b76e4b.js";import{s as Ae,g as Ue,a as Fe}from"./webauthn-json.browser-ponyfill-29d8152c.js";const Oe="https://github.com/AlliotTech/openalist";function ze(a){return pe("".concat(a,"-").concat(Oe))}var Be=V('<svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink height=896 width=967.8852157128662><defs><path id=path-2 opacity=1 fill-rule=evenodd d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id=linearGradient-3 x1=0.5 y1=0 x2=0.5 y2=1><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-2 fill=url(#linearGradient-3) fill-opacity=1>');const De=a=>{const c=J({startColor:"#28aff0",endColor:"#120fc4"},a);return(()=>{var n=Be(),d=n.firstChild,p=d.firstChild,o=p.nextSibling,u=o.firstChild,s=u.nextSibling;return q(t=>{var i=c.startColor,h=c.endColor;return i!==t.e&&I(u,"stop-color",t.e=i),h!==t.t&&I(s,"stop-color",t.t=h),t},{e:void 0,t:void 0}),n})()};var Ke=V('<svg height=1337 width=1337><defs><path id=path-1 opacity=1 fill-rule=evenodd d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id=linearGradient-2 x1=0.79 y1=0.62 x2=0.21 y2=0.86><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use xlink:href=#path-1 fill=url(#linearGradient-2) fill-opacity=1>');const je=a=>{const c=J({startColor:"#28aff0",endColor:"#120fc4"},a);return(()=>{var n=Ke(),d=n.firstChild,p=d.firstChild,o=p.nextSibling,u=o.firstChild,s=u.nextSibling;return q(t=>{var i=c.startColor,h=c.endColor;return i!==t.e&&I(u,"stop-color",t.e=i),h!==t.t&&I(s,"stop-color",t.t=h),t},{e:void 0,t:void 0}),n})()},Ne=()=>{const a=z("linear-gradient(135deg, #a9c6ff 0%,rgb(233, 154, 211) 100%)","linear-gradient(135deg, #062b74 0%, #1a2980 100%)"),c=[{style:{position:"absolute",top:"10%",left:"15%",width:"300px",height:"300px",background:"radial-gradient(circle, #fff6 0%, #fff0 70%)",filter:"blur(40px)",opacity:.7,pointerEvents:"none"}},{style:{position:"absolute",bottom:"15%",right:"10%",width:"250px",height:"250px",background:"radial-gradient(circle, #a9c6ff88 0%, #fff0 80%)",filter:"blur(30px)",opacity:.5,pointerEvents:"none"}}];return e(w,{get bg(){return a()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[he(()=>c.map(n=>e(w,{get style(){return n.style}}))),e(w,{pos:"absolute",top:"0",left:"0",w:"100vw",h:"100vh",style:{background:"rgba(255,255,255,0.15)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",pointerEvents:"none"}}),e(w,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(je,{})}}),e(w,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(De,{})}})]}})},We=()=>{const a=E("sso_login_enabled"),c=S("sso_login_platform"),n=E("sso_compatibility_mode"),{searchParams:d,to:p}=Q(),o=d.token;o!=null&&o!=""&&(y(o),p(decodeURIComponent(d.redirect||_||"/"),!0));function u(s){const t=s.data;t.token&&(y(t.token),p(decodeURIComponent(d.redirect||_||"/"),!0))}if(window.addEventListener("message",u),X(()=>{window.removeEventListener("message",u)}),a){const s=()=>{const i=x.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=i;return}window.open(i,"authPopup","width=500,height=600")};let t;switch(c){case"Github":t=Ce;break;case"Microsoft":t=we;break;case"Google":t=be;break;case"Dingtalk":t=me;break;default:t=fe}return e(Y,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:s})}},qe=()=>{const a=S("logo").split("\n"),c=z(a[0],a.pop()),n=ve(),d=xe(()=>"".concat(n("login.login_to")," ").concat(S("site_title")));Me(d);const p=z("white","$neutral1"),[o,u]=b(localStorage.getItem("username")||""),[s,t]=b(localStorage.getItem("password")||""),[i,h]=b(""),[$,ee]=b(!1),[k,te]=ye("remember-pwd","false"),[L,B]=b(!1),[ne,re]=A(async()=>L()?x.post("/auth/login/ldap",{username:o(),password:s(),otp_code:i()}):x.post("/auth/login/hash",{username:o(),password:ze(s()),otp_code:i()})),[,oe]=A((r,l,m,M)=>x.post("/authn/webauthn_finish_login?username="+m,JSON.stringify(l),{headers:{session:r},signal:M})),[,ae]=A((r,l)=>x.get("/authn/webauthn_begin_login?username="+r,{signal:l})),{searchParams:G,to:R}=Q(),se=async()=>PublicKeyCredential&&"isConditionalMediationAvailable"in PublicKeyCredential?await PublicKeyCredential.isConditionalMediationAvailable():!1,D=E("webauthn_login_enabled"),ie=async()=>{ee(!$())};let g=null;const K=async r=>{if(!Ae()){r||v.error(n("users.webauthn_not_supported"));return}if(r&&!await se())return;g==null||g.abort();const l=new AbortController;g=l;const m=r?"":o();!r&&k()==="true"?localStorage.setItem("username",o()):localStorage.removeItem("username");const M=await ae(m,l.signal);Te(M,async W=>{try{const f=Ue(W.options);f.signal=l.signal,r&&(f.mediation="conditional");const ue=await Fe(f),de=await oe(W.session,ue,m,l.signal);H(de,ge=>{v.success(n("login.success")),y(ge.token),R(decodeURIComponent(G.redirect||_||"/"),!0)})}catch(f){f instanceof Error&&f.name!="AbortError"&&v.error(f.message)}})},j=()=>g==null?void 0:g.abort();_e(()=>{D&&(window.addEventListener("beforeunload",j),K(!0))}),X(()=>{g==null||g.abort(),window.removeEventListener("beforeunload",j)});const P=async()=>{if($())await K();else{k()==="true"?(localStorage.setItem("username",o()),localStorage.setItem("password",s())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const r=await re();H(r,l=>{v.success(n("login.success")),y(l.token),R(decodeURIComponent(G.redirect||_||"/"),!0)},(l,m)=>{!T()&&m===402?le(!0):v.error(l)})}},[T,le]=b(!1),N=E("ldap_login_enabled"),ce=S("ldap_login_tips");return N&&B(!0),e(Pe,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e($e,{get bgColor(){return p()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(U,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ke,{mr:"$2",boxSize:"$12",get src(){return c()}}),e(Se,{color:"$info9",fontSize:"$2xl",get children(){return d()}})]}}),e(C,{get when(){return!T()},get fallback(){return e(F,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return i()},onInput:r=>h(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&P()}})},get children(){return[e(F,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return o()},onInput:r=>u(r.currentTarget.value)}),e(C,{get when(){return!$()},get children(){return e(F,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return s()},onInput:r=>t(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&P()}})}}),e(U,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(Z,{get checked(){return k()==="true"},onChange:()=>te(k()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(Ie,{as:"a",target:"_blank",get href(){return n("login.forget_url")},get children(){return n("login.forget")}})]}})]}}),e(Ee,{w:"$full",spacing:"$2",get children(){return[e(C,{get when(){return!$()},get children(){return e(O,{colorScheme:"primary",w:"$full",onClick:()=>{T()?h(""):(u(""),t(""))},get children(){return n("login.clear")}})}}),e(O,{w:"$full",get loading(){return ne()},onClick:P,get children(){return n("login.login")}})]}}),e(C,{when:N,get children(){return e(Z,{w:"$full",get checked(){return L()===!0},onChange:()=>B(!L()),children:ce})}}),e(O,{w:"$full",colorScheme:"accent",onClick:()=>{y(),R(decodeURIComponent(G.redirect||_||"/"),!0)},get children(){return n("login.use_guest")}}),e(U,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Le,{}),e(Ge,{}),e(We,{}),e(C,{when:D,get children(){return e(Y,{cursor:"pointer",boxSize:"$8",as:Re,p:"$0_5",onclick:ie})}})]}})]}}),e(Ne,{})]}})};export{qe as default};
